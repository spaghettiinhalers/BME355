%% splineInterp_0p01.m
% This script loads a set of (x,y) data points, sorts them, averages any
% duplicates, and then performs spline interpolation at 0.01 increments.

clear; clc; close all;

%% Step 1: Define the Data
data = [
    0.4318200801871033, -0.23548603736098528;
    0.4604368526561977, -0.9336586335377781;
    0.4604368526561977, -0.6072485725621686;
    0.47474523889074494, -1.3526899446923757;
    0.5033620113598394, -1.0871756941792743;
    0.546287170063481, -1.0386293837406306;
    0.5892123287671236, -1.1299730994343928;
    0.6321374874707653, -1.1280567977065505;
    0.6607542599398597, -1.0646059182735907;
    0.7179878048780486, -1.0154208405923342;
    0.7609129635816902, -1.0135045388644919;
    0.8038381222853319, -0.96495822842585;
    0.8467632809889745, -0.9630419266980095;
    0.8896884396926161, -0.9766689612070998;
    0.9326135983962578, -1.0524693406639294;
    0.9755387570998995, -1.0660963751730215;
    1.07569746074173,   -0.99945165952699;
    1.1186226194453726, -0.9664486853252807;
    1.1615477781490142, -1.057792401019043;
    1.1973187437353818, -0.9473921292539735;
    1.2617064817908448, -1.0066910216099458;
    1.3046316404944864, -0.9736880474082383;
    1.347556799198128,  -1.1272051080497345;
    1.3904819579017706, -1.06311546137416;
    1.4334071166054123, -0.9368524697508462;
    1.46917808219178,   -0.9352555516443122;
    1.5335658202472429, -0.9323810990525505;
    1.5693367858336114, -0.9074691765906167;
    1.6337245238890743, -0.9279097283542548;
    1.676649682592716,  -0.9259934266264143;
    1.7124206481790836, -0.9243965085198784;
    1.748191613765452,  -0.6430195381485362;
    1.7696541931172733,  0.3604837999976134;
    1.7768083862345465,  0.6638982402391296;
    1.7982709655863678,  1.4109365304758708;
    1.8483503174072826,  2.0659923377762386;
    1.8626587036418298,  2.3464111572836615;
    1.8984296692281983,  2.814308162498209;
    1.9342006348145668,  3.608615228688368;
    1.948509021049114,   3.9356640569065906;
    1.9914341797527557,  4.357250437031644;
    2.012896759104576,   4.637988640160373;
    2.062976110925492,   5.0132643951959315;
    2.1631348145673233,  4.877845739761824;
    2.198905780153691,   4.879442657868358;
    2.270447711326427,   4.579541437461217;
    2.3849148012028056,  4.584651575402128;
    2.4349941530237214,  4.470312238974272;
    2.549461242900099,   4.382162359493579;
    2.606694787838288,   4.2215123979762295;
    2.613848980955562,   3.9653667336881284;
    2.6210031740728352,  4.525246221839051;
    2.6210031740728352,  3.6859060650446267;
    2.6210031740728352,  3.4061260127798185;
    2.6281573671901093,  3.0800353354255154;
    2.6353115603073825,  2.753944658071214;
    2.6353115603073825,  2.474164605806406;
    2.6353115603073825,  2.194384553541598;
    2.6353115603073825,  1.9146045012767878;
    2.6496199465419297,  1.5422031988329898;
    2.6496199465419297,  1.0759031117249762;
    2.6591588706982954,  0.594485533208438;
    2.6996992983628454,  0.5885237056107115;
    2.7640870364183083,  0.4748231364254689;
    2.9715586368192435,  0.20430520917855866;
    3.0502547611092536,  0.207818429012935;
    1.7671232876712333, -0.23361056751467757;
    1.7671232876712333,  0.034246575342463004;
    1.7876712328767121,  0.9726638943248513;
    1.8287671232876708,  1.778069960861055;
    1.910958904109589,   3.2549535225048896;
    2.116438356164383,   5.005198140900194;
    2.321917808219178,   4.612585616438354;
    2.486301369863013,   4.352067025440312;
    2.815068493150684,   0.34888698630136794;
    2.8767123287671232,  0.21771037181996;
    2.917808219178082,   0.2195450097847349;
    3.102739726027397,   0.09387230919764811;
    3.1643835616438354,  0.09662426614481134;
    3.226027397260273,   0.0993762230919728;
    3.2671232876712315,  0.1012108610567477;
    3.308219178082191,   0.1030454990215226;
    3.3698630136986285,  0.10579745596868584;
    3.410958904109588,   0.10763209393346074
];

%% Step 2: Sort Data by x
sorted_data = sortrows(data,1);

%% Step 3: Average y-values for duplicate x-values
x_all = sorted_data(:,1);
y_all = sorted_data(:,2);

[unique_x, ~, idx] = unique(x_all);
unique_y = accumarray(idx, y_all, [], @mean);

%% Step 4: Create a uniform x-vector with 0.01 increments
x_min = min(unique_x);
x_max = max(unique_x);
x_dense = (x_min : 0.01 : x_max)';

%% Step 5: Spline interpolation on the uniform grid
y_spline = interp1(unique_x, unique_y, x_dense, 'spline');

%% Step 6: Plot results
figure; 
hold on;
plot(unique_x, unique_y, 'ro-', 'MarkerSize', 4, 'LineWidth', 1.5); 
plot(x_dense, y_spline, 'b.-', 'MarkerSize', 8, 'LineWidth', 1);
xlabel('x'); ylabel('y');
legend('Averaged Data','Spline Interpolation','Location','best');
title('Spline Interpolation at 0.01 increments');
grid on;

% Assume x_dense and y_spline have been computed as column vectors
data_interp = [x_dense, y_spline];   % Concatenate x and y as two columns

% Save the data to a CSV file named 'spline_interpolated_data.csv'
writematrix(data_interp, 'spline_interpolated_data.csv');
